@using GestAgape.Core.Entities;
@using GestAgape.Infrastructure.Utilities;
@using Microsoft.AspNetCore.Identity;
@using GestAgape.Core.Entities.Identity;

@inject SignInManager<ApplicationUsers> SignInManager
@inject UserManager<ApplicationUsers> UserManager
@using Microsoft.AspNetCore.Http
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor


@if (SignInManager.IsSignedIn(User))
{
    string campus = HttpContextAccessor.HttpContext.Session.GetString(SessionInfo.CurrentCampusName);


    var id = UserManager.GetUserId(User);
    var user = UserManager.Users.First(u => u.Id == id);
    var username = user.FirstName + " " + user.LastName;


    <!-- End Right navbar var -->
    <!-- top navigation -->
    <div class="nav_menu">
        <div class="nav toggle">
            <a id="menu_toggle"><i class="fa fa-bars"></i></a>
        </div>
        <nav class="nav navbar-nav">
            <ul class=" navbar-right">
                <li class="nav-item dropdown open" style="padding-left: 15px;">
                    <a href="javascript:;" class="user-profile dropdown-toggle" aria-haspopup="true" id="navbarDropdown" data-toggle="dropdown" aria-expanded="false">
                        @{
                            //recuperation du path de la photo de profile @SessionInfo.ReceptionnisteName
                            var PhotoPath = user.ProfilePicture;
                        }
                        @if (PhotoPath != "")
                        {
                            <img src="@Url.Content($"~/Data/ProfileImageFolder/{ PhotoPath}")" class="avatar img-fluid rounded me-1" alt="@username" />
                        }
                        else
                        {
                            <img src="~/img/avatars/avatar.png" class="avatar img-fluid rounded me-1" alt="@username">
                        }
                        @*<span class="text-dark">(@campus)</span>*@
                        <span class="text-dark">Bienvenue @username</span>
                    </a>
                    <div class="dropdown-menu dropdown-usermenu pull-right" aria-labelledby="navbarDropdown">
                        @*<a class="dropdown-item" href="javascript:;"> Profile</a>
                        <a class="dropdown-item" href="javascript:;">
                            <span class="badge bg-red pull-right">50%</span>
                            <span>Settings</span>
                        </a>
                        <a class="dropdown-item" href="javascript:;">Help</a>*@
                        <a class="dropdown-item" asp-controller="IdentityManagement" asp-action="LogOut"><i class="fa fa-sign-out pull-right"></i> Log Out</a>
                    </div>
                </li>

            </ul>
        </nav>
    </div>
    <!-- /top navigation -->
}
else
{
    <div class="nav_menu">
        <nav class="nav navbar-nav">
            <ul class=" col-2 navbar-right">
                <a class="nav-link btn" id=" login" asp-action="Login" asp-controller="IdentityManagement" style="background-color:#22a9e1; color: white"> Se Connecter </a>
            </ul>
        </nav>
    </div>
}
